<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</title>
<style>
:root {
  --bg:#0f1724; --card:#0b1220; --txt:white; --accent:#01c38d; --glass:rgba(255,255,255,0.04);
}
body { background:var(--bg); font-family:"Tajawal",sans-serif; margin:0; padding:20px; color:var(--txt);}
.container{max-width:800px;margin:auto;}
.search-box {background:var(--glass);border:1px solid #1e293b;padding:12px;border-radius:10px;margin-bottom:20px;display:flex;gap:10px;}
input {flex:1;background:none;border:none;color:var(--txt);padding:10px;outline:none;}

.results {display:flex;flex-direction:column;gap:10px;}
.card {background:var(--card);padding:8px 12px;border-radius:10px;display:flex;gap:10px;align-items:center;border:1px solid #1f2a3a;cursor:pointer;transition:0.25s;}
.card:hover {border-color:var(--accent);}
.card img {width:60px;height:40px;object-fit:cover;border-radius:6px;flex-shrink:0;}
.card-info {display:flex;flex-direction:column;flex:1;min-width:0;}
.card-info h3 {margin:0;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.card-info p {margin:2px 0 0;font-size:13px;color:#8ef;}
.new-badge {background:#01c38d;color:#012;padding:2px 6px;border-radius:6px;font-size:11px;font-weight:bold;margin-left:6px;}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.overlay{
  position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7);
  display:none; z-index:1000;
}
.overlay.show { display:block; }

.card-popup{
  position: fixed; top:50%; left:50%; transform: translate(-50%,-50%);
  background: var(--card); border-radius:16px; width:90%; max-width:400px; padding:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.4); z-index:1001;
}
.close-btn{position:absolute;top:10px;left:14px;background:none;border:none;color:#fff;font-size:24px;font-weight:bold;cursor:pointer;line-height:1;}
.close-btn:hover{color:var(--accent);}
.popup-img{width:100%;height:auto;max-height:180px;object-fit:cover;border-radius:12px;margin-bottom:12px;}
.popup-info h2{margin:0 0 6px 0;font-size:18px;}
.popup-info p{margin:2px 0;color:#8ef;font-size:13px;}
.popup-actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;}
.popup-actions a{flex:1;justify-content:center;background:var(--accent);color:#012;padding:8px;border-radius:10px;text-decoration:none;display:flex;align-items:center;gap:5px;}

/* Ø§Ù„Ø¬ÙˆØ§Ù„ */
@media(max-width:600px){
  .card {flex-direction:row;align-items:center;padding:6px;}
  .card img{width:50px;height:35px;}
  .card-info h3{font-size:14px;}
  .card-info p{font-size:12px;}
  .card-popup{padding:12px;}
  .popup-img{max-height:150px;}
  .popup-info h2{font-size:16px;}
  .popup-info p{font-size:12px;}
  .popup-actions a{font-size:12px;padding:6px;}
}
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</h2>
  <div class="search-box">
    <input id="searchInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø±Ø³ÙŠÙØ±...">
  </div>
  <div id="results" class="results"></div>
</div>

<!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="overlay" class="overlay">
  <div class="card-popup">
    <button id="closePopup" class="close-btn">âœ–</button>
    <img id="popupImg" class="popup-img" src="" alt="">
    <div class="popup-info">
      <h2 id="popupName"></h2>
      <p id="popupVersion"></p>
      <p id="popupDate"></p>
      <p id="popupSize"></p>
    </div>
    <div class="popup-actions">
      <a id="popupDownload" href="#" target="_blank">â¬‡ ØªØ­Ù…ÙŠÙ„</a>
      <a id="popupWhats" href="#" target="_blank">ÙˆØ§ØªØ³Ø§Ø¨</a>
    </div>
  </div>
</div>

<script>
// Ø§Ù„Ø´ÙŠØªØ§Øª
const SHEET_ID = "2PACX-1vQXW9rev-EPbzS_pXVSa3xoylhsjYwHFE8n0xa9wDoxrkMdFgsn8srViSagCj8kqI-iHpEwpk5w2FuF";
const SHEETS = [
  { name: "Sheet1", gid: "1337227866" },
// Ù…Ø«Ø§Ù„
];
let allDevices = [];

// Ø±Ø§Ø¨Ø· CSV Ù„ÙƒÙ„ Ø´ÙŠØª
function getCSVUrl(sheet){ return `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?output=csv&gid=${sheet.gid}`; }

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø© ÙŠÙˆÙ…
function parseURLData(url=""){
  let versionMatch = url.match(/V(\d+(?:\.\d+)?)/i);
  let version = versionMatch ? "V"+versionMatch[1] : "-";
  let dateMatch = url.match(/(\d{8})/);
  let releaseDate="-"; let isNew=false;
  if(dateMatch){
    let d = dateMatch[1];
    let updateDate = new Date(`${d.slice(4,8)}-${d.slice(2,4)}-${d.slice(0,2)}`);
    updateDate.setDate(updateDate.getDate()+1);
    const day = String(updateDate.getDate()).padStart(2,'0');
    const month = String(updateDate.getMonth()+1).padStart(2,'0');
    const year = updateDate.getFullYear();
    releaseDate = `${day}/${month}/${year}`;
    const today = new Date();
    const diffDays = (today - updateDate)/(1000*60*60*24);
    if(diffDays <= 15 && diffDays >=0) isNew=true;
  }
  return {version, releaseDate, isNew};
}

// CSV -> JSON
function parseCSV(csv){
  const rows = csv.split(/\r?\n/).map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/));
  const headers = rows[0];
  return rows.slice(1).map(row=>{
    let item={};
    headers.forEach((h,i)=>{ item[h.trim()] = row[i]?row[i].trim().replace(/"/g,""):"-"; });
    const extra = parseURLData(item.url);
    item.version=extra.version; item.date=extra.releaseDate; item.isNew=extra.isNew;
    item.name = item.name || "-"; item.size=item.size||"-"; item.image=item.image||"";
    return item;
  });
}

// Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ø´ÙŠØªØ§Øª
async function fetchSheets(){
  for(let sheet of SHEETS){
    try{
      const res = await fetch(getCSVUrl(sheet));
      const csv = await res.text();
      allDevices.push(...parseCSV(csv));
    }catch(err){ console.error("ÙØ´Ù„ Ø¬Ù„Ø¨:",sheet.name,err); }
  }
  showResults(allDevices);
}
fetchSheets();
// Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªØ­Ù‚Ù‚ Ù…Ù† ?search= ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
fetchSheets().then(() => {
  const urlParams = new URLSearchParams(window.location.search);
  const searchQuery = urlParams.get('search');
  if(searchQuery){
    searchInput.value = searchQuery; // Ø¶Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø«
    searchInput.dispatchEvent(new Event('input')); // Ø´ØºÙ‘Ù„ Ø§Ù„Ø¨Ø­Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  }
});

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­ÙŠ
document.getElementById("searchInput").addEventListener("input",()=>{
  let q = searchInput.value.trim().toLowerCase();
  let filtered = allDevices.filter(d=> (d.name||"").toLowerCase().includes(q));
  showResults(filtered);
});

// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ ÙØ±Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ù‹Ø§
function showResults(list){
  let box = document.getElementById("results");
  box.innerHTML="";
  if(!list.length){ box.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>"; return; }
  list.sort((a,b)=> a.isNew && !b.isNew?-1: !a.isNew && b.isNew?1:0);
  list.forEach(item=>{
    box.innerHTML+=`
      <div class="card" onclick='showPopup(${JSON.stringify(item).replace(/'/g,"\\'")})'>
        ${item.image?`<img src="${item.image}" alt="${item.name}">`:""}
        <div class="card-info">
          <h3>${item.name} ${item.isNew?'<span class="new-badge">Ø¬Ø¯ÙŠØ¯ ğŸ”¥</span>':""}</h3>
          <p>Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${item.version} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${item.date}</p>
        </div>
      </div>
    `;
  });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
const overlay = document.getElementById("overlay");
const popupImg = document.getElementById("popupImg");
const popupName = document.getElementById("popupName");
const popupVersion = document.getElementById("popupVersion");
const popupDate = document.getElementById("popupDate");
const popupSize = document.getElementById("popupSize");
const popupDownload = document.getElementById("popupDownload");
const popupWhats = document.getElementById("popupWhats");
const closePopup = document.getElementById("closePopup");

function showPopup(item){
  popupImg.src = item.image || "";
  popupName.textContent = item.name;
  popupVersion.textContent = "Ø§Ù„Ø¥ØµØ¯Ø§Ø±: " + item.version;
  popupDate.textContent = "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + item.date;
  popupSize.textContent = "Ø§Ù„Ø­Ø¬Ù…: " + item.size;
  popupDownload.href = item.url;

  // ØªØ¹Ø¯ÙŠÙ„ Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ù„ÙŠØ´Ù…Ù„ Ø§Ù„Ù…ØµØ¯Ø±
// Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ ÙŠØ¶Ø¹ Ø§Ø³Ù… Ø§Ù„Ø±Ø³ÙŠÙØ± ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¶Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹
const searchURL = `${window.location.origin}${window.location.pathname}?search=${encodeURIComponent(item.name)}`;
const whatsappText = `ğŸ“¡ ${item.name}
ğŸ”¢ Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${item.version}
ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${item.date}
ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: ${searchURL}`;

popupWhats.href = "https://wa.me/?text=" + encodeURIComponent(whatsappText);


  overlay.classList.add("show");

  // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø±Ø¬ÙˆØ¹
  history.pushState({popup:true}, "");
}
// Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
closePopup.onclick = closePopupFunc;

// Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
overlay.onclick = e => {
  if(e.target === overlay) closePopupFunc();
}

// Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
window.addEventListener("popstate", e => {
  if(overlay.classList.contains("show")) overlay.classList.remove("show");
});

function closePopupFunc(){
  overlay.classList.remove("show");
  // Ø¥Ø²Ø§Ù„Ø© Ø³Ø¬Ù„ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø³Ø¬Ù„ popup
  if(history.state && history.state.popup){
    history.replaceState(null, "");
  }
}


</script>

</body>
</html>
