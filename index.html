<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</title>
<style>
:root {
  --bg:#0f1724; --card:#0b1220; --txt:white; --accent:#01c38d; --glass:rgba(255,255,255,0.04);
}
body { background:var(--bg); font-family:"Tajawal",sans-serif; margin:0;padding:20px;color:var(--txt);}
.container{max-width:600px;margin:auto;}
.search-box {background:var(--glass);border:1px solid #1e293b;padding:12px;border-radius:10px;margin-bottom:20px;display:flex;gap:10px;}
input {flex:1;background:none;border:none;color:var(--txt);padding:10px;outline:none;}
.card {background:var(--card);padding:15px;border-radius:12px;margin:10px 0;border:1px solid #1f2a3a;transition:0.25s;display:flex;gap:10px;align-items:center;}
.card:hover {border-color:var(--accent);}
.card img {width:80px;height:50px;object-fit:cover;border-radius:6px;}
a {color:var(--accent);text-decoration:none;}
.version {color:#8ef;font-size:14px;}
.new-badge {background:#01c38d;color:#012;padding:2px 6px;border-radius:6px;font-size:12px;margin-left:6px;font-weight:bold;}
</style>
</head>
<body>
<div class="container">
  <h2>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</h2>
  <div class="search-box">
    <input id="searchInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø±Ø³ÙŠÙØ±...">
  </div>
  <div id="results"></div>
</div>

<script>
// Ù…Ø¹Ø±Ù Ø§Ù„Ø´ÙŠØª
const SHEET_ID = "2PACX-1vQXW9rev-EPbzS_pXVSa3xoylhsjYwHFE8n0xa9wDoxrkMdFgsn8srViSagCj8kqI-iHpEwpk5w2FuF";

// ØªØ¹Ø±ÙŠÙ ÙƒÙ„ Ø§Ù„Ø´ÙŠØªØ§Øª Ø¨Ø§Ù„Ù€ gid
const SHEETS = [
  { name: "Sheet1", gid: "1337227866" },
 // Ù…Ø«Ø§Ù„
];

let allDevices = [];

// Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· CSV Ù„ÙƒÙ„ Ø´ÙŠØª
function getCSVUrl(sheet) {
  return `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?output=csv&gid=${sheet.gid}`;
}

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„
function parseURLData(url = "") {
  let versionMatch = url.match(/V(\d+(?:\.\d+)?)/i);
  let version = versionMatch ? "V" + versionMatch[1] : "-";

  let dateMatch = url.match(/(\d{8})/);
  let releaseDate = "-";
  let isNew = false;
  if (dateMatch) {
    let d = dateMatch[1];
    releaseDate = `${d.slice(0,2)}/${d.slice(2,4)}/${d.slice(4,8)}`;
    const updateDate = new Date(`${d.slice(4,8)}-${d.slice(2,4)}-${d.slice(0,2)}`);
    const today = new Date();
    const diffDays = (today - updateDate)/(1000*60*60*24);
    if(diffDays <= 15 && diffDays >=0) isNew = true;
  }
  return { version, releaseDate, isNew };
}

// ØªØ­ÙˆÙŠÙ„ CSV Ø¥Ù„Ù‰ JSON
function parseCSV(csv) {
  const rows = csv.split(/\r?\n/).map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/));
  const headers = rows[0];
  return rows.slice(1).map(row=>{
    let item = {};
    headers.forEach((header, index) => {
      item[header.trim()] = row[index] ? row[index].trim().replace(/"/g,"") : "-";
    });
    const extra = parseURLData(item.url);
    item.version = extra.version;
    item.date = extra.releaseDate;
    item.isNew = extra.isNew;
    item.name = item.name || "-";
    item.size = item.size || "-";
    item.image = item.image || "";
    return item;
  });
}

// Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ÙƒÙ„ Ø§Ù„Ø´ÙŠØªØ§Øª
async function fetchSheets() {
  for (let sheet of SHEETS) {
    const url = getCSVUrl(sheet);
    try {
      const res = await fetch(url);
      const csv = await res.text();
      allDevices.push(...parseCSV(csv));
    } catch(err) {
      console.error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†:", sheet.name, err);
    }
  }
  showResults(allDevices);
}
fetchSheets();

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­ÙŠ
document.getElementById("searchInput").addEventListener("input", ()=>{
  let q = searchInput.value.trim().toLowerCase();
  let filtered = allDevices.filter(d => (d.name || "").toLowerCase().includes(q));
  showResults(filtered);
});

// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ ÙØ±Ø² Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ù‹Ø§
function showResults(list) {
  let box = document.getElementById("results");
  box.innerHTML = "";
  if (!list.length) { 
    box.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>"; 
    return; 
  }

  // ÙØ±Ø² Ø¨Ø­ÙŠØ« ØªØ¸Ù‡Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ù‹Ø§
  list.sort((a,b)=>{
    if(a.isNew && !b.isNew) return -1;
    if(!a.isNew && b.isNew) return 1;
    return 0; // Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø­Ø³Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ØµÙ„ÙŠ
  });

  list.forEach(item=>{
    box.innerHTML += `
      <div class="card">
        ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ''}
        <div>
          <h3>
            ${item.name} 
            ${item.isNew ? '<span class="new-badge">Ø¬Ø¯ÙŠØ¯ ğŸ”¥</span>' : ''}
          </h3>
          <p class="version">Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${item.version}</p>
          <p class="version">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${item.date}</p>
          <p>Ø§Ù„Ø­Ø¬Ù…: ${item.size}</p>
          <a href="${item.url}" target="_blank">â¬‡ ØªØ­Ù…ÙŠÙ„</a>
        </div>
      </div>
    `;
  });
}

</script>
</body>
</html>
