<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</title>
<style>
:root {
  --bg:#0f1724; --card:#0b1220; --txt:white; --accent:#01c38d; --glass:rgba(255,255,255,0.04);
}
body { background:var(--bg); font-family:"Tajawal",sans-serif; margin:0; padding:20px; color:var(--txt);}
.container{max-width:800px; margin:auto;}
.search-box {background:var(--glass); border:1px solid #1e293b; padding:12px; border-radius:10px; margin-bottom:20px; display:flex; gap:10px;}
input {flex:1; background:none; border:none; color:var(--txt); padding:10px; outline:none;}
.card {background:var(--card); padding:10px 12px; border-radius:10px; margin:6px 0; border:1px solid #1f2a3a; display:flex; align-items:center; gap:12px; cursor:pointer; transition:0.3s;}
.card:hover { border-color:var(--accent);}
.card img {width:60px; height:40px; object-fit:cover; border-radius:6px; flex-shrink:0;}
.card .info {flex:1; display:flex; flex-direction:column;}
.card .name {font-weight:600; font-size:15px; display:flex; align-items:center; gap:6px;}
.card .version {font-size:13px; color:#8ef; margin-top:2px;}
.new-badge {background:#01c38d; color:#012; padding:2px 6px; border-radius:6px; font-size:12px; font-weight:bold;}
/* Overlay */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:10px;}
.overlay.show{display:flex;}
.overlay .card-detail{background:var(--card); border-radius:14px; max-width:500px; width:100%; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.4); position:relative;}
.overlay .close-btn{position:absolute; top:10px; left:14px; background:none; border:none; color:#fff; font-size:24px; cursor:pointer;}
.overlay .card-detail img{width:100%; height:auto; border-radius:10px; margin-bottom:12px;}
.overlay .card-detail h2{margin:0 0 6px 0;}
.overlay .details{display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:12px;}
.overlay .details div{background:rgba(255,255,255,0.03); padding:8px; border-radius:8px; flex:1; text-align:center;}
.overlay .actions{display:flex; justify-content:center; gap:10px; flex-wrap:wrap;}
.overlay .actions a{background:transparent; border:1px solid rgba(255,255,255,0.1); padding:8px 12px; border-radius:10px; color:#fff; text-decoration:none; display:flex; align-items:center; gap:6px; transition:0.3s;}
.overlay .actions a:hover{border-color:var(--accent); color:var(--accent);}
@media(max-width:500px){.card{flex-direction:column;align-items:flex-start;}.card img{width:100%;height:auto;}}
</style>
</head>
<body>
<div class="container">
  <h2>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</h2>
  <div class="search-box">
    <input id="searchInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø±Ø³ÙŠÙØ±...">
  </div>
  <div id="results"></div>
</div>

<!-- Overlay Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="overlay" class="overlay">
  <div class="card-detail">
    <button id="closeCard" class="close-btn">âœ–</button>
    <img id="detailImg" src="" alt="">
    <h2 id="detailName"></h2>
    <div class="details">
      <div><b>Ø§Ù„Ø¥ØµØ¯Ø§Ø±</b><div id="detailVersion"></div></div>
      <div><b>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«</b><div id="detailDate"></div></div>
      <div><b>Ø§Ù„Ø­Ø¬Ù…</b><div id="detailSize"></div></div>
    </div>
    <div class="actions">
      <a id="downloadLink" target="_blank">â¬‡ ØªØ­Ù…ÙŠÙ„</a>
      <a id="whatsappShare" target="_blank">ÙˆØ§ØªØ³Ø§Ø¨</a>
    </div>
  </div>
</div>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø´ÙŠØªØ§Øª
const SHEET_ID = "2PACX-1vQXW9rev-EPbzS_pXVSa3xoylhsjYwHFE8n0xa9wDoxrkMdFgsn8srViSagCj8kqI-iHpEwpk5w2FuF";
const SHEETS = [
  { name:"Sheet1", gid:"1337227866" },
  // Ù…Ø«Ø§Ù„
];
let allDevices = [];

// Ø±Ø§Ø¨Ø· CSV Ù„ÙƒÙ„ Ø´ÙŠØª
function getCSVUrl(sheet){ return `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/pub?output=csv&gid=${sheet.gid}`; }

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¥ØµØ¯Ø§Ø± ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ²ÙŠØ§Ø¯Ø© ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯
function parseURLData(url=""){
  let versionMatch = url.match(/V(\d+(?:\.\d+)?)/i);
  let version = versionMatch ? "V"+versionMatch[1]:"-";

  let dateMatch = url.match(/(\d{8})/);
  let releaseDate="-";
  let isNew=false;
  if(dateMatch){
    let d=dateMatch[1];
    let updateDate = new Date(`${d.slice(4,8)}-${d.slice(2,4)}-${d.slice(0,2)}`);
    updateDate.setDate(updateDate.getDate()+1);
    const day = String(updateDate.getDate()).padStart(2,'0');
    const month = String(updateDate.getMonth()+1).padStart(2,'0');
    const year = updateDate.getFullYear();
    releaseDate=`${day}/${month}/${year}`;
    const today = new Date();
    const diffDays=(today-updateDate)/(1000*60*60*24);
    if(diffDays<=15 && diffDays>=0) isNew=true;
  }
  return {version, releaseDate, isNew};
}

// ØªØ­ÙˆÙŠÙ„ CSV Ø¥Ù„Ù‰ JSON
function parseCSV(csv){
  const rows = csv.split(/\r?\n/).map(r=>r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/));
  const headers = rows[0];
  return rows.slice(1).map(row=>{
    let item={};
    headers.forEach((h,i)=>item[h.trim()]=row[i]?row[i].trim().replace(/"/g,""):"-");
    const extra = parseURLData(item.url);
    item.version = extra.version;
    item.date = extra.releaseDate;
    item.isNew = extra.isNew;
    item.name=item.name||"-";
    item.size=item.size||"-";
    item.image=item.image||"";
    return item;
  });
}

// Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
async function fetchSheets(){
  for(let sheet of SHEETS){
    try{
      const res = await fetch(getCSVUrl(sheet));
      const csv = await res.text();
      allDevices.push(...parseCSV(csv));
    }catch(err){console.error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†:",sheet.name,err);}
  }
  showResults(allDevices);
}
fetchSheets();

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­ÙŠ
document.getElementById("searchInput").addEventListener("input", ()=>{
  const q = searchInput.value.trim().toLowerCase();
  const filtered = allDevices.filter(d=>(d.name||"").toLowerCase().includes(q));
  showResults(filtered);
});

// Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆÙØ±Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ù‹Ø§
function showResults(list){
  const box = document.getElementById("results");
  box.innerHTML="";
  if(!list.length){box.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>";return;}

  list.sort((a,b)=>a.isNew&&!b.isNew?-1:!a.isNew&&b.isNew?1:0);

  list.forEach(item=>{
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <img src="${item.image}" alt="${item.name}">
      <div class="info">
        <div class="name">${item.name} ${item.isNew?'<span class="new-badge">Ø¬Ø¯ÙŠØ¯ ğŸ”¥</span>':''}</div>
        <div class="version">Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${item.version}</div>
        <div class="version">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${item.date}</div>
      </div>
    `;
    card.onclick = ()=>showOverlay(item);
    box.appendChild(card);
  });
}

// Overlay Ø§Ù„ØªÙØ§ØµÙŠÙ„
const overlay = document.getElementById("overlay");
const closeCard = document.getElementById("closeCard");
const detailImg = document.getElementById("detailImg");
const detailName = document.getElementById("detailName");
const detailVersion = document.getElementById("detailVersion");
const detailDate = document.getElementById("detailDate");
const detailSize = document.getElementById("detailSize");
const downloadLink = document.getElementById("downloadLink");
const whatsappShare = document.getElementById("whatsappShare");

function showOverlay(item){
  detailImg.src = item.image;
  detailName.textContent = item.name;
  detailVersion.textContent = item.version;
  detailDate.textContent = item.date;
  detailSize.textContent = item.size;
  downloadLink.href = item.url;
  whatsappShare.href = `https://wa.me/?text=${encodeURIComponent(`ğŸ“º ${item.name}\nğŸ”¢ Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${item.version}\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${item.date}\nğŸ”— ${item.url}`)}`;
  overlay.classList.add("show");
}

closeCard.onclick=()=>overlay.classList.remove("show");
overlay.onclick=e=>{if(e.target===overlay) overlay.classList.remove("show");};
</script>
</body>
</html>
``
