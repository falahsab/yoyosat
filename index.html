<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🔍 بحث عن الرسيفرات</title>

<style>
:root {
  --bg:#0f1724;--card:#0b1220;--txt:white;--accent:#01c38d;--glass:rgba(255,255,255,0.04)
}
body {
  background:var(--bg);
  font-family:"Tajawal",sans-serif;
  margin:0;padding:20px;color:var(--txt)
}
.container{max-width:600px;margin:auto}
.search-box {
  background:var(--glass);
  border:1px solid #1e293b;
  padding:12px;
  border-radius:10px;
  margin-bottom:20px;
  display:flex;
  gap:10px
}
input {
  flex:1;
  background:none;
  border:none;
  color:var(--txt);
  padding:10px;
  outline:none;
}
.card {
  background:var(--card);
  padding:15px;
  border-radius:12px;
  margin:10px 0;
  border:1px solid #1f2a3a;
  transition:0.25s
}
.card:hover { border-color:var(--accent) }
a { color:var(--accent); text-decoration:none }
.version { color:#8ef; font-size:14px }
</style>
</head>

<body>
<div class="container">
  <h2>🔍 بحث عن الرسيفرات</h2>

  <div class="search-box">
    <input id="searchInput" type="text" placeholder="اكتب اسم الرسيفر...">
  </div>

  <div id="results"></div>
</div>

<script>
const SHEET_ID = "1fvlOESmcjdE1DaiivSe8FB_pMp85MWzOajS9OWRzmow";
const SHEETS = ["sheet3"];
let allDevices = [];

// تحسين تقسيم CSV ليقرأ الحقول مهما كانت الفواصل داخلها
function parseCSV(csv) {
  const rows = csv.split(/\r?\n/).map(r => r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/));
  const headers = rows[0];
  return rows.slice(1).map(row => {
    let obj = {};
    headers.forEach((h,i)=> obj[h.trim()] = row[i] ? row[i].trim().replace(/"/g,"") : "-");
    return obj;
  });
}

// استخراج الإصدار والتاريخ من رابط التحديث
function parseURLData(url = "") {
  let versionMatch = url.match(/V(\d+(?:\.\d+)?)/i);
  let version = versionMatch ? "V" + versionMatch[1] : "-";

  let dateMatch = url.match(/(\d{8})/);
  let releaseDate = "-";
  if (dateMatch) {
    let d = dateMatch[1];
    releaseDate = `${d.slice(0,2)}/${d.slice(2,4)}/${d.slice(4,8)}`;
  }
  return { version, releaseDate };
}

// جلب أوراق الشيت بصيغة CSV
async function fetchSheets() {
  for (let sheet of SHEETS) {
    let url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${sheet}`;
    let res = await fetch(url);
    let csv = await res.text();
    let data = parseCSV(csv);

    data.forEach(item=>{
      const extra = parseURLData(item.url || "");
      item.version = extra.version;
      item.date = extra.releaseDate;
      item.name = item.name || "-";
      item.size = item.size || "-";
      item.image = item.image || "";
      allDevices.push(item);
    });
  }
  showResults(allDevices);
}

fetchSheets();

// بحث تلقائي
document.getElementById("searchInput").addEventListener("input", ()=>{
  let q = searchInput.value.trim().toLowerCase();
  let filtered = allDevices.filter(d =>
    (d.name || "").toLowerCase().includes(q)
  );
  showResults(filtered);
});

// عرض النتائج في الصفحة
function showResults(list) {
  let box = document.getElementById("results");
  box.innerHTML = "";
  if (!list.length) {
    box.innerHTML = "<p>لا توجد نتائج</p>";
    return;
  }

  list.forEach(item=>{
    box.innerHTML += `
      <div class="card">
        <h3>${item.name}</h3>
        <p class="version">الإصدار: ${item.version}</p>
        <p class="version">تاريخ التحديث: ${item.date}</p>
        <p>الحجم: ${item.size}</p>
        <a href="${item.url}" target="_blank">⬇ تحميل</a>
      </div>
    `;
  });
}
</script>

</body>
</html>




