<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</title>
<style>
:root {
  --bg:#0f1724;--card:#0b1220;--accent:#06b6d4;
  --muted:#94a3b8;--glass:rgba(255,255,255,0.04);
}
*{box-sizing:border-box;font-family:"Segoe UI","Noto Kufi Arabic",sans-serif;}
body{margin:0;background:linear-gradient(180deg,#071021,#071a2a);color:#e6eef6;padding:28px;min-height:100vh;}
.container{max-width:980px;margin:auto;}
header{text-align:center;margin-bottom:18px;}
h1{font-size:22px;margin:0;}
.search-box{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 8px 25px rgba(0,0,0,0.35);}
.inputs{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
input[type=text]{flex:1;min-width:200px;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;font-size:15px;}
button{background:var(--accent);color:#012;padding:11px 16px;border-radius:10px;border:none;cursor:pointer;transition:0.3s;}
button:hover{opacity:0.9;}
.hint{color:var(--muted);font-size:13px;margin-top:8px;text-align:center;}

/* Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
.results {
  margin-top: 12px;
  display: grid;
  grid-template-columns: 1fr;
  gap: 8px;
}
.result-item {
  background: var(--glass);
  padding: 10px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  border: 1px solid transparent;
  transition: background 0.2s, border-color 0.2s;
}
.result-item:hover {
  border-color: rgba(6,182,212,0.15);
  background: rgba(255,255,255,0.03);
}
.thumb {
  width: 42px;
  height: 42px;
  border-radius: 6px;
  overflow: hidden;
  flex-shrink: 0;
}
.thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.meta {
  flex: 1;
  display: flex;
  flex-direction: column;
}
.meta .name {
  font-weight: 600;
  font-size: 15px;
}
.meta .small {
  font-size: 12px;
  color: var(--muted);
  margin-top: 2px;
}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:10px;}
.overlay.show{display:flex;}
.card{position:relative;background:var(--card);border-radius:16px;max-width:600px;width:100%;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.4);animation:fadeIn .4s ease;}
@keyframes fadeIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.close-btn{position:absolute;top:10px;left:14px;background:none;border:none;color:#fff;font-size:24px;font-weight:bold;cursor:pointer;transition:.3s;line-height:1;}
.close-btn:hover{color:var(--accent);transform:scale(1.2);}
.card-head{display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin-top:30px;}
.big-thumb{width:200px;height:130px;border-radius:12px;overflow:hidden;flex-shrink:0;cursor:pointer;transition:transform .3s;}
.big-thumb img{width:100%;height:100%;object-fit:cover;}
.big-thumb.fullscreen{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(1.3);z-index:2000;width:auto;height:auto;max-width:90%;max-height:90%;border-radius:14px;object-fit:contain;background:#000;}
.info{flex:1;}
.info h2{margin:0 0 6px 0;font-size:20px;}
.info p{margin:0;color:var(--muted);}
.details{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:14px;}
.detail{background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;text-align:center;}
.detail b{display:block;margin-bottom:6px;color:var(--accent);}
.actions{margin-top:14px;text-align:center;display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);padding:10px 16px;border-radius:10px;color:#fff;cursor:pointer;transition:.3s;text-decoration:none;display:flex;align-items:center;}
.btn-ghost:hover{border-color:var(--accent);color:var(--accent);}
.actions svg{width:20px;height:20px;margin-left:6px;fill:#25D366;transition:0.3s;}
.actions svg:hover{transform:scale(1.2);}
footer{margin-top:26px;color:var(--muted);font-size:13px;text-align:center;}
</style>
</head>
<body>
<div class="container">
  <header><h1>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</h1></header>
  <section class="search-box">
    <div class="inputs">
      <input id="search" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø±Ø³ÙŠÙØ±..." autocomplete="off">
      <button id="clearBtn">Ù…Ø³Ø­</button>
    </div>
    <div class="hint">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªØ¸Ù‡Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©.</div>
    <div id="results" class="results"></div>
  </section>
  <footer>ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets</footer>
</div>

<!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
<div id="overlay" class="overlay">
  <div class="card">
    <button id="closeCard" class="close-btn">âœ–</button>
    <div class="card-head">
      <div class="big-thumb" id="bigThumb"><img id="cardImg" src="" alt=""></div>
      <div class="info">
        <h2 id="cardName">-</h2>
        <p id="cardSummary">Ù…Ù„Ø®Øµ</p>
      </div>
    </div>
    <div class="details">
      <div class="detail"><b>Ø§Ù„Ø­Ø¬Ù…</b><div id="cardSize">-</div></div>
      <div class="detail"><b>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«</b><div id="cardDate">-</div></div>
    </div>
    <div class="actions">
      <a id="downloadLink" class="btn-ghost" target="_blank">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«</a>
      <a id="whatsappShare" class="btn-ghost" target="_blank">
        ÙˆØ§ØªØ³Ø§Ø¨
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
          <path d="M16.04 2.003c-7.732 0-14.01 6.278-14.01 14.01 0 2.47.643 4.88 1.87 7.004l-1.95 7.13 7.3-1.91c2.06 1.12 4.38 1.71 6.79 1.71h.01c7.73 0 14.01-6.28 14.01-14.01s-6.28-14.01-14.01-14.01zm0 25.5h-.01c-2.19 0-4.33-.56-6.2-1.61l-.44-.25-4.33 1.14 1.16-4.23-.28-.44c-1.15-1.82-1.76-3.93-1.76-6.1 0-6.35 5.17-11.52 11.52-11.52 3.08 0 5.98 1.2 8.16 3.38 2.18 2.18 3.38 5.08 3.38 8.16 0 6.35-5.17 11.52-11.52 11.52zm6.35-8.64c-.35-.18-2.09-1.03-2.41-1.15-.32-.12-.55-.18-.78.18-.23.35-.89 1.15-1.1 1.39-.2.23-.4.26-.75.09-.35-.18-1.47-.54-2.8-1.72-1.03-.92-1.72-2.06-1.92-2.41-.2-.35-.02-.54.15-.71.15-.15.35-.4.52-.6.18-.2.23-.35.35-.58.12-.23.06-.43-.03-.61-.09-.18-.78-1.87-1.07-2.56-.28-.68-.57-.59-.78-.6l-.66-.01c-.23 0-.6.09-.91.43-.32.35-1.2 1.17-1.2 2.85s1.23 3.3 1.4 3.53c.18.23 2.42 3.69 5.86 5.18.82.35 1.46.56 1.96.72.82.26 1.57.23 2.17.14.66-.1 2.09-.85 2.39-1.67.29-.82.29-1.52.2-1.67-.09-.14-.32-.23-.66-.4z"/>
        </svg>
      </a>
    </div>
  </div>
</div>

<script>
const search = document.getElementById('search');
const results = document.getElementById('results');
const overlay = document.getElementById('overlay');
const cardName = document.getElementById('cardName');
const cardSummary = document.getElementById('cardSummary');
const cardImg = document.getElementById('cardImg');
const cardSize = document.getElementById('cardSize');
const cardDate = document.getElementById('cardDate');
const downloadLink = document.getElementById('downloadLink');
const whatsappShare = document.getElementById('whatsappShare');
const closeCard = document.getElementById('closeCard');
const clearBtn = document.getElementById('clearBtn');
const bigThumb = document.getElementById('bigThumb');

let receivers = [];
let currentReceiver = null;

// ğŸ”— Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Google Sheet Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙƒÙ€ CSV
const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQXW9rev-EPbzS_pXVSa3xoylhsjYwHFE8n0xa9wDoxrkMdFgsn8srViSagCj8kqI-iHpEwpk5w2FuF/pub?output=csv';

async function loadCSV(url){
  try{
    const res = await fetch(url);
    if(!res.ok) throw new Error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    const text = await res.text();
    const rows = text.replace(/^\uFEFF/,'').trim().split(/\r?\n/).map(r=>r.split(','));
    const headers = rows.shift().map(h=>h.trim());
    return rows.map(r=>{
      const obj = {};
      headers.forEach((h,i)=> obj[h]=r[i]?.trim()||'');
      return obj;
    });
  }catch(e){console.error(e); return [];}
}

async function loadAll(){
  receivers = await loadCSV(sheetURL);
  renderResults(receivers);
}

function renderResults(list){
  results.innerHTML = '';
  if(list.length === 0){
    results.innerHTML = '<div style="color:var(--muted);padding:12px;text-align:center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
    return;
  }

  const counter = document.createElement('div');
  counter.style.textAlign = 'center';
  counter.style.margin = '6px 0';
  counter.style.color = 'var(--muted)';
  counter.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${list.length}`;
  results.appendChild(counter);

  list.forEach(r => {
    const item = document.createElement('div');
    item.className = 'result-item';

    let shortName = r.name.replace(/[-_]\d{6,8}[-_](zip|bin|rar|tar).*$/i, '');
    shortName = shortName.replace(/[-_](zip|bin|rar)$/i, '');

    item.innerHTML = `
      <div class="thumb"><img src="${r.image}" alt="${r.name}"></div>
      <div class="meta">
        <div class="name">${shortName}</div>
        <div class="small">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${r.latest_date || r.date || '-'}</div>
      </div>
    `;
    item.addEventListener('click', () => showCard(r));
    results.appendChild(item);
  });
}

function showCard(r){
  currentReceiver = r;
  cardName.textContent = r.name;
  cardSummary.textContent = `Ø§Ù„Ø­Ø¬Ù…: ${r.size}`;
  cardImg.src = r.image;
  cardSize.textContent = r.size;
  cardDate.textContent = r.date;
  const downloadURL = `https://swdw.net/index.php/table/${encodeURIComponent(r.name)}/download`;
  downloadLink.href = downloadURL;
  whatsappShare.href = `https://wa.me/?text=${encodeURIComponent(`ğŸ“º ${r.name}\nğŸ”— ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«:\n${downloadURL}`)}`;
  overlay.classList.add('show');
}

closeCard.onclick = () => overlay.classList.remove('show');
overlay.onclick = e => { if(e.target===overlay) overlay.classList.remove('show'); };
bigThumb.onclick = () => bigThumb.classList.toggle('fullscreen');
clearBtn.onclick = () => { search.value=''; renderResults(receivers); search.focus(); };

search.addEventListener('input', () => {
  const q = search.value.trim().toLowerCase();
  const filtered = receivers.filter(r => (r.name||'').toLowerCase().includes(q));
  renderResults(filtered);
});

loadAll();
</script>
</body>
</html>
