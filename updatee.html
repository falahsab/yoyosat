<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</title>
<style>
:root {
  --bg:#0f1724;--card:#0b1220;--accent:#06b6d4;
  --muted:#94a3b8;--glass:rgba(255,255,255,0.04);
}
*{box-sizing:border-box;font-family:"Segoe UI","Noto Kufi Arabic",sans-serif;}
body{margin:0;background:linear-gradient(180deg,#071021,#071a2a);color:#e6eef6;padding:28px;min-height:100vh;}
.container{max-width:980px;margin:auto;}
header{text-align:center;margin-bottom:18px;}
h1{font-size:22px;margin:0;}
.search-box{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 8px 25px rgba(0,0,0,0.35);}
.inputs{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
input[type=text]{flex:1;min-width:200px;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:inherit;font-size:15px;}
button{background:var(--accent);color:#012;padding:11px 16px;border-radius:10px;border:none;cursor:pointer;transition:0.3s;}
button:hover{opacity:0.9;}
.hint{color:var(--muted);font-size:13px;margin-top:8px;text-align:center;}

/* Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
.results {margin-top:12px;display:grid;grid-template-columns:1fr;gap:8px;}
.result-item {background:var(--glass);padding:10px;border-radius:8px;display:flex;align-items:center;gap:10px;cursor:pointer;border:1px solid transparent;transition:background 0.2s,border-color 0.2s;position:relative;}
.result-item:hover {border-color:rgba(6,182,212,0.15);background:rgba(255,255,255,0.03);}
.thumb {width:42px;height:42px;border-radius:6px;overflow:hidden;flex-shrink:0;}
.thumb img {width:100%;height:100%;object-fit:cover;display:block;}
.meta {flex:1;display:flex;flex-direction:column;}
.meta .name {font-weight:600;font-size:15px;}
.meta .small {font-size:12px;color:var(--muted);margin-top:2px;}
.new-badge {position:absolute;right:10px;top:10px;background:#06b6d4;color:#012;padding:2px 6px;font-size:11px;border-radius:6px;font-weight:bold;}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:10px;}
.overlay.show{display:flex;}
.card{position:relative;background:var(--card);border-radius:16px;max-width:600px;width:100%;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.4);animation:fadeIn .4s ease;}
@keyframes fadeIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.close-btn{position:absolute;top:10px;left:14px;background:none;border:none;color:#fff;font-size:24px;font-weight:bold;cursor:pointer;transition:.3s;line-height:1;}
.close-btn:hover{color:var(--accent);transform:scale(1.2);}
.card-head{display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin-top:30px;}
.big-thumb{width:200px;height:130px;border-radius:12px;overflow:hidden;flex-shrink:0;cursor:pointer;transition:transform .3s;}
.big-thumb img{width:100%;height:100%;object-fit:cover;}
.big-thumb.fullscreen{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(1.3);z-index:2000;width:auto;height:auto;max-width:90%;max-height:90%;border-radius:14px;object-fit:contain;background:#000;}
.info{flex:1;}
.info h2{margin:0 0 6px 0;font-size:20px;}
.info p{margin:0;color:var(--muted);}
.details{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:14px;}
.detail{background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;text-align:center;}
.detail b{display:block;margin-bottom:6px;color:var(--accent);}
.actions{margin-top:14px;text-align:center;display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);padding:10px 16px;border-radius:10px;color:#fff;cursor:pointer;transition:.3s;text-decoration:none;display:flex;align-items:center;}
.btn-ghost:hover{border-color:var(--accent);color:var(--accent);}
.actions svg{width:20px;height:20px;margin-left:6px;fill:#25D366;transition:0.3s;}
.actions svg:hover{transform:scale(1.2);}
footer{margin-top:26px;color:var(--muted);font-size:13px;text-align:center;}
</style>
</head>
<body>
<div class="container">
  <header><h1>ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ø³ÙŠÙØ±Ø§Øª</h1></header>
  <section class="search-box">
    <div class="inputs">
      <input id="search" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø±Ø³ÙŠÙØ±..." autocomplete="off">
      <button id="clearBtn">Ù…Ø³Ø­</button>
    </div>
    <div id="results" class="results"></div>
  </section>
  <footer>ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets</footer>
</div>

<!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
<div id="overlay" class="overlay">
  <div class="card">
    <button id="closeCard" class="close-btn">âœ–</button>
    <div class="card-head">
      <div class="big-thumb" id="bigThumb"><img id="cardImg" src="" alt=""></div>
      <div class="info">
        <h2 id="cardName">-</h2>
        <p id="cardSummary">-</p>
      </div>
    </div>
    <div class="details">
      <div class="detail"><b>Ø§Ù„Ø¥ØµØ¯Ø§Ø±</b><div id="cardVersion">-</div></div>
      <div class="detail"><b>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«</b><div id="cardDate">-</div></div>
    </div>
    <div class="actions">
      <a id="downloadLink" class="btn-ghost" target="_blank">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«</a>
      <a id="whatsappShare" class="btn-ghost" target="_blank">
        ÙˆØ§ØªØ³Ø§Ø¨
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M16.04 2.003c-7.732 0-14.01 6.278-14.01 14.01 0 2.47.643 4.88 1.87 7.004l-1.95 7.13 7.3-1.91c2.06 1.12 4.38 1.71 6.79 1.71h.01c7.73 0 14.01-6.28 14.01-14.01s-6.28-14.01-14.01-14.01z"/></svg>
      </a>
    </div>
  </div>
</div>

<script>
const search=document.getElementById('search');
const results=document.getElementById('results');
const overlay=document.getElementById('overlay');
const cardName=document.getElementById('cardName');
const cardSummary=document.getElementById('cardSummary');
const cardImg=document.getElementById('cardImg');
const cardVersion=document.getElementById('cardVersion');
const cardDate=document.getElementById('cardDate');
const downloadLink=document.getElementById('downloadLink');
const whatsappShare=document.getElementById('whatsappShare');
const closeCard=document.getElementById('closeCard');
const clearBtn=document.getElementById('clearBtn');
const bigThumb=document.getElementById('bigThumb');

let receivers=[];
const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vSmuOkSY7cZKXccabamqgcYMY2wy91yAMc3rJSQNKidABGW7vgLR9-cLILlBdF-HeiYYrA9ka_HRXAj/pub?output=csv";

async function loadCSV(url){
  const res=await fetch(url);
  const text=await res.text();
  const rows=text.trim().split("\n").slice(1);
  return rows.map(r=>{
    const [url,image]=r.split(",");
    return {url:url.trim(),image:image?.trim()};
  });
}

function parseURLData(url){
  const match=url.match(/table\/([^\/]+)\/download/i);
  if(!match)return null;
  const raw=match[1];
  let name=raw.split("-v")[0].toUpperCase();
  let versionMatch=raw.match(/v(\d+(?:[-_.]\d+)?)/i);
  let version=versionMatch?"v"+versionMatch[1].replace(/[-_]/,"."):"-";
  let dateMatch=raw.match(/(\d{8})/);
  let date="-";
  let isNew=false;
  if(dateMatch){
    const d=dateMatch[1];
    date=`${d.slice(0,2)}/${d.slice(2,4)}/${d.slice(4)}`;
    const updateDate=new Date(`${d.slice(4)}/${d.slice(2,4)}/${d.slice(0,2)}`);
    const today=new Date();
    const diff=(today-updateDate)/(1000*60*60*24);
    if(diff>=0 && diff<=15)isNew=true;
  }
  return {name,version,date,isNew};
}

function renderResults(list){
  results.innerHTML='';
  if(search.value.trim()==='')return;
  if(list.length===0){
    results.innerHTML='<div style="color:var(--muted);text-align:center;padding:10px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
    return;
  }
  list.forEach(r=>{
    const data=parseURLData(r.url);
    if(!data)return;
    const item=document.createElement('div');
    item.className='result-item';
    item.innerHTML=`
      ${data.isNew?'<div class="new-badge">Ø¬Ø¯ÙŠØ¯</div>':''}
      <div class="thumb"><img src="${r.image}" alt=""></div>
      <div class="meta">
        <div class="name">${data.name}</div>
        <div class="small">Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${data.version} &nbsp;&nbsp; ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${data.date}</div>
      </div>
    `;
    item.onclick=()=>showCard(r,data);
    results.appendChild(item);
  });
}

function showCard(r,data){
  cardName.innerHTML=`${data.isNew?'<span class="new-badge">Ø¬Ø¯ÙŠØ¯</span> ':''}${data.name}`;

  cardImg.src=r.image;
  cardVersion.textContent=data.version;
  cardDate.textContent=data.date;
  downloadLink.href=r.url;
  whatsappShare.href=`https://wa.me/?text=${encodeURIComponent(`ğŸ“º ${data.name}\nğŸ”¢ Ø§Ù„Ø¥ØµØ¯Ø§Ø±: ${data.version}\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${data.date}\nğŸ”— ${r.url}`)}`;
  overlay.classList.add('show');
}

closeCard.onclick=()=>overlay.classList.remove('show');
overlay.onclick=e=>{if(e.target===overlay)overlay.classList.remove('show');};
bigThumb.onclick=()=>bigThumb.classList.toggle('fullscreen');
clearBtn.onclick=()=>{search.value='';results.innerHTML='';search.focus();};

search.addEventListener('input',()=>{
  const q=search.value.trim().toLowerCase();
  if(!q){results.innerHTML='';return;}
  const filtered=receivers.filter(r=>{
    const d=parseURLData(r.url);
    return d&&d.name.toLowerCase().includes(q);
  });
  renderResults(filtered);
});

(async()=>{receivers=await loadCSV(sheetURL);})();
</script>
</body>
</html>
